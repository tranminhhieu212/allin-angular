<div class="inline-block">
  <button nz-button nzType="default" nz-dropdown [nzDropdownMenu]="menu" [(nzVisible)]="isDropdownOpen"
    class="flex items-center gap-2">
    <i nz-icon nzType="menu"></i>
    <span>Columns ({{ getVisibleCount() }}/{{ getTotalCount() }})</span>
    <i nz-icon [nzType]="isDropdownOpen ? 'up' : 'down'"></i>
  </button>

  <nz-dropdown-menu #menu="nzDropdownMenu">
    <div nz-menu class="min-w-[580px] max-h-[600px] flex flex-col p-0">
      <!-- Header -->
      <div class="p-4 border-b border-gray-200">
        <h4 class="m-0 text-sm font-semibold text-gray-800">Show/Hide & Reorder Columns</h4>
      </div>

      <!-- Columns Container -->
      <div class="grid grid-cols-2 gap-3 p-4 max-h-[480px] overflow-hidden">
        <!-- Visible Columns Section -->
        <div class="flex flex-col min-h-0">
          <div class="flex items-center gap-2 px-3 py-2 bg-gray-50 border border-gray-200 rounded-t-md mb-0">
            <i nz-icon nzType="eye" nzTheme="outline"></i>
            <span class="text-xs font-semibold text-gray-700">Visible ({{ visibleColumns.length }})</span>
          </div>
          <div id="visible-list" cdkDropList
            class="flex-1 p-2 overflow-y-auto min-h-[200px] max-h-[420px] border border-t-0 border-gray-200 rounded-b-md bg-white"
            [cdkDropListData]="visibleColumns" [cdkDropListConnectedTo]="['hidden-list']"
            (cdkDropListDropped)="onDrop($event)">
            <div *ngFor="let column of visibleColumns" cdkDrag
              class="flex items-center gap-2 px-2 py-1.5 rounded-md transition-all bg-white border border-transparent mb-1"
              [class.opacity-60]="column.locked" [class.cursor-not-allowed]="column.locked"
              [class.bg-gray-50]="column.locked" [class.hover:bg-gray-50]="!column.locked"
              [class.hover:border-gray-300]="!column.locked" [cdkDragData]="column" [cdkDragDisabled]="column.locked">

              <span class="flex-1 text-sm text-gray-700 select-none">{{ column.headerName }}</span>
              <i nz-icon nzType="lock" nzTheme="fill" class="text-gray-400 ml-auto" *ngIf="column.locked"></i>

              <!-- Drag preview -->
              <div class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-md shadow-lg"
                *cdkDragPreview>
                <i nz-icon nzType="drag"></i>
                <span class="text-sm text-gray-700 font-medium">{{ column.headerName }}</span>
              </div>
            </div>

            <!-- Empty state -->
            <nz-empty *ngIf="visibleColumns.length === 0" [nzNotFoundContent]="'No visible columns'"
              nzSize="small"></nz-empty>
          </div>
        </div>

        <!-- Hidden Columns Section -->
        <div class="flex flex-col min-h-0">
          <div class="flex items-center gap-2 px-3 py-2 bg-gray-50 border border-gray-200 rounded-t-md mb-0">
            <i nz-icon nzType="eye-invisible" nzTheme="outline"></i>
            <span class="text-xs font-semibold text-gray-700">Hidden ({{ hiddenColumns.length }})</span>
          </div>
          <div id="hidden-list"
            class="flex-1 p-2 overflow-y-auto min-h-[200px] max-h-[420px] border border-t-0 border-gray-200 rounded-b-md bg-white"
            cdkDropList [cdkDropListData]="hiddenColumns" [cdkDropListConnectedTo]="['visible-list']"
            (cdkDropListDropped)="onDrop($event)">
            <div *ngFor="let column of hiddenColumns"
              class="flex items-center gap-2 px-2 py-1.5 rounded-md transition-all bg-white border border-transparent mb-1"
              [class.opacity-60]="column.locked" [class.cursor-not-allowed]="column.locked"
              [class.bg-gray-50]="column.locked" [class.hover:bg-gray-50]="!column.locked"
              [class.hover:border-gray-300]="!column.locked" cdkDrag [cdkDragData]="column"
              [cdkDragDisabled]="column.locked">

              <span class="flex-1 text-sm text-gray-400 select-none">{{ column.headerName }}</span>
              <i nz-icon nzType="lock" nzTheme="fill" class="text-gray-400 ml-auto" *ngIf="column.locked"></i>

              <!-- Drag preview -->
              <div class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-md shadow-lg"
                *cdkDragPreview>
                <i nz-icon nzType="drag"></i>
                <span class="text-sm text-gray-700 font-medium">{{ column.headerName }}</span>
              </div>
            </div>

            <!-- Empty state -->
            <nz-empty *ngIf="hiddenColumns.length === 0" [nzNotFoundContent]="'All columns visible'"
              nzSize="small"></nz-empty>
          </div>
        </div>
      </div>

      <div class="p-4 pt-0 border-b border-gray-200 flex justify-end">
        <div class="flex gap-2">
          <button nz-button nzType="primary" (click)="showAll()">Save</button>
          <button nz-button nzType="default" (click)="reset()">Reset</button>
        </div>
      </div>
    </div>
  </nz-dropdown-menu>
</div>